services:
  - type: web
    name: vidhived-backend
    env: python
    buildCommand: pip install -r backend/requirements.txt
    startCommand: cd backend && gunicorn -w 4 -b 0.0.0.0:$PORT wsgi:application
    envVars:
      - key: GCP_PROJECT_ID
        sync: false
      - key: GCP_REGION
        value: us-central1
      - key: GCS_BUCKET_NAME
        sync: false
      - key: GOOGLE_APPLICATION_CREDENTIALS
        value: /etc/secrets/gcp-key.json
      - key: LOG_LEVEL
        value: INFO
      - key: CORS_ORIGINS
        fromService:
          type: web
          name: vidhived-frontend
          property: host
    secretFiles:
      - fromFile: gcp-key.json
        toPath: /etc/secrets/gcp-key.json

  - type: web
    name: vidhived-frontend
    env: node
    buildCommand: cd frontend && npm ci && npm run build
    startCommand: cd frontend && npm run start
    envVars:
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: vidhived-backend
          property: host